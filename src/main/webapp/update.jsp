<?xml version="1.0" encoding="UTF-8"?><%@ page contentType="text/html; charset=UTF-8" language="java" import="com.justjournal.User" %><%@ page import="com.justjournal.WebError" %><%@ page import="com.justjournal.core.Statistics" %><%@ page import="com.justjournal.db.*" %><%@ page import="com.justjournal.utility.StringUtil" %><%@ page import="com.justjournal.utility.Xml" %><%@ page import="java.io.PrintWriter" %><%@ page import="java.sql.*" %><%@ page import="java.text.ParsePosition" %><%@ page import="java.text.SimpleDateFormat" %><%@ page import="java.util.Collection" %><%@ page import="java.util.Iterator" %><%    response.setHeader("Vary", "Accept"); // content negotiation    response.setDateHeader("Expires", System.currentTimeMillis());    response.setDateHeader("Last-Modified", System.currentTimeMillis());    response.setHeader("Cache-Control", "no-store, no-cache, must-revalidate");    response.setHeader("Pragma", "no-cache");    // date stuff    java.text.SimpleDateFormat fmtdate = new java.text.SimpleDateFormat("yyyy-MM-dd");    java.text.SimpleDateFormat fmttime = new java.text.SimpleDateFormat("HH:mm:ss");    java.sql.Date now = new java.sql.Date(System.currentTimeMillis());// Get the session user input    String sbody = (String) session.getAttribute("spell.body");    String smusic = (String) session.getAttribute("spell.music");    String ssubject = (String) session.getAttribute("spell.subject");    String stags = (String) session.getAttribute("spell.tags");    String strackback = (String) session.getAttribute("spell.trackback");    if (sbody == null)        sbody = "";    if (smusic == null)        smusic = "";    if (ssubject == null)        ssubject = "";    if (stags == null)        stags = "";    if (strackback == null)        strackback = "";%><!DOCTYPE html><html><head>    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">    <title>JustJournal.com: Update Journal</title>    <link rel="stylesheet" type="text/css" href="layout.css" media="all">    <link rel="stylesheet" type="text/css" href="font-normal.css" media="all">    <link rel="home" title="Home" href="/#/">    <link rel="contents" title="Site Map" href="/#/sitemap"/>    <link rel="help" title="Technical Support" href="/#/support/"/>    <script type="text/javascript" src="components/jquery/jquery.min.js"></script>    <script type="text/javascript" src="js/jquery.validate.min.js"></script>    <script type="text/javascript" src="js/additional-methods.min.js"></script>    <!--    <script type="text/javascript" src="FCKeditor/fckeditor.js">//iesucks</script>    <script type="text/javascript">        window.onload = function()        {            var oFCKeditor = new FCKeditor('body');            oFCKeditor.BasePath = '/FCKeditor/';            oFCKeditor.Height = 300;            oFCKeditor.Width = 572;            oFCKeditor.Config["CustomConfigurationsPath"] = '/js/fckconfig.js';            oFCKeditor.Config['SkinPath'] = '/FCKeditor/editor/skins/office2003/';            oFCKeditor.Config['AutoDetectLanguage'] = true;            oFCKeditor.ToolbarSet = 'JJ';            oFCKeditor.ReplaceTextarea();        }        function FCKeditor_OnComplete(editorInstance)        {            document.getElementById("aformat").checked = false;            document.getElementById("aformatrow").style.visibility = "hidden";            document.getElementById("newlinetext").style.visibility = "hidden";            document.getElementById("aformatrow").style.display="none";            document.getElementById("newlinetext").style.display="none";        }    </script>    -->    <style type="text/css" media="all">        div.row {            clear: both;            padding-top: 5px;        }        div.row span.label {            float: left;            width: 140px;            text-align: right;        }        div.row span.formw {            float: right;            width: 400px;            text-align: left;        }        div.spacer {            clear: both;        }        fieldset {            border: 2px solid #6FCADE;            background: white;            color: #333;        }        legend {           color: navy;           font-weight: bold;        }    </style>    <script type="text/javascript">        $("#frmUpdateJournal").validate({          submitHandler: function(form) {            form.submit();          }         });        $('#tags').bind('change', function(){            this.value = this.value.toLocaleLowerCase();        } );    </script></head><body><jsp:include page="header.inc" flush="false"/><div id="content"><h2>Update Journal</h2><p>Post a journal entry.</p><div style="width: 575px; padding: 5px; margin: 0;"><form method="post" action="updateJournal" name="frmUpdateJournal" id="frmUpdateJournal"><%    Integer userID = (Integer) session.getAttribute("auth.uid");    int ival = 0;    if (userID != null) {        ival = userID.intValue();    }    if (ival < 1) {%><fieldset>    <legend><strong>Login Information</strong><br/></legend>    <div class="row">        <span class="label"><label for="user">Username</label></span>			<span class="formw"><input type="text" name="user" id="user" size="18" maxlength="15"                                       style="background: url(images/userclass_16.png) no-repeat; background-color: #fff; background-position: 0 1px; padding-left: 18px; color: black; font-weight: bold;"/></span>    </div>    <div class="row">        <span class="label"><label for="pass">Password</label></span>			<span class="formw"><input type="password" name="pass" id="pass" size="18" maxlength="18"                                       style="background: white; color: black; font-weight: bold;"/>			</span>    </div>    <div class="row">			<span class="formw"><input type="checkbox" name="keeplogin" id="keeplogin"                                       value="checked" checked="checked"/>			<label for="keeplogin">Keep login after post</label>			</span>    </div>    <!-- Hack to fix spacing problem.. especially with text boxes -->    <div class="spacer">&nbsp;</div></fieldset><% } else { %><p>You are logged in as <a href="/users/<%= session.getAttribute("auth.user") %>"><img src="images/userclass_16.png"                                                                                       alt="user"/><%= session.getAttribute("auth.user") %></a>.    If you want to post to another journal, <a href="logout.jsp">log out</a> first.</p><% } %><fieldset>    <legend><strong>Journal Entry</strong><br/></legend>    <div class="row">        <span class="label"><label for="date">Date</label></span>	  <span class="formw"><input name="date" id="date" value="<%=fmtdate.format( now ) %>" size="15" maxlength="10"               date="true" required="true">	  </span>    </div>    <div class="row">        <span class="label"><label for="time">Time</label></span>        <span class="formw"><input name="time" id="time" value="T<%=fmttime.format( now ) %>" size="15" maxlength="8"                dojoType="dijit.form.TimeTextBox"      constraints="{timePattern:'HH:mm:ss'}"      required="true"></span>    </div>    <div class="row">        <span class="label"><label for="subject">Subject</label></span>	  <span class="formw"><input name="subject" type="text" id="subject" size="30" maxlength="150"                                 value="<%=ssubject%>" dojoType="dijit.form.TextBox"                trim="true" />	  (optional)</span>    </div>    <%        String spellcheck = (String) session.getAttribute("spell.check");        if (spellcheck == null)            spellcheck = "";        if (spellcheck.compareTo("true") == 0) {    %>    <div class="row">        <strong>Your spell-checked post:</strong><br/>        <%=sbody%>    </div>    <div class="row">        <strong>Suggestions:</strong><br/>        <%=(String) session.getAttribute("spell.suggest")%>    </div>    <%        }    %>    <div class="row"><textarea id="body" name="body" style="width: 100%" cols="60"            rows="20"><%=sbody%></textarea>    </div>    <div class="row" id="newlinetext">        <span class="formw">by default, newlines will be auto-formatted to &lt;br&gt;</span>    </div>    <div class="row">			<span class="formw"><input type="checkbox" name="spellcheck" id="spellcheck"                                       value="checked" />			<label for="spellcheck">Spell check entry before posting</label>			</span>    </div>    <!-- Hack to fix spacing problem.. especially with text boxes -->    <div class="spacer">&nbsp;</div></fieldset><fieldset><legend><strong>Optional Settings</strong><br/></legend><div class="row">    <span class="label"><label for="security">Security</label></span>	  <span class="formw">	  	<select id="security" name="security" size="1" dojoType="dijit.form.FilteringSelect" autoComplete="false" invalidMessage="Invalid security setting">              <%                  Integer ssec = (Integer) session.getAttribute("spell.security");                  int issec = 0;                  if (ssec != null) {                      issec = ssec.intValue();                  }                  /* Check to see if the Journal is marked private */                  boolean prvt = false;                  try {                      prvt = (ival > 0 &&                              new User((String) session.getAttribute("auth.user")).isPrivateJournal());                  } catch (Exception e) {                      // ignore exception.                  }                  for (java.util.Iterator iterator = SecurityDao.view().iterator(); iterator.hasNext();) {                      SecurityTo o = (SecurityTo) iterator.next();                      out.print("\t<option value=\"" + o.getId());                      if (prvt && o.getName().compareTo("private") == 0)                          out.print("\" selected=\"selected\">");                      else if ((o.getName().compareTo("public") == 0 && !prvt)                              || o.getId() == issec)                          out.print("\" selected=\"selected\">");                      else                          out.print("\">");                      out.println(o.getName() + "</option>");                  }              %>          </select>	  </span></div><div class="row">    <span class="label"><label for="location">Location</label></span>	  <span class="formw">	  	<select id="location" name="location" size="1" dojoType="dijit.form.FilteringSelect" autoComplete="false" invalidMessage="Invalid location">              <%                  Integer sloc = (Integer) session.getAttribute("spell.location");                  int isloc = -1;                  if (sloc != null) {                      isloc = sloc.intValue();                  }                  for (Iterator iterator = LocationDao.view().iterator(); iterator.hasNext();) {                      LocationTo o = (LocationTo) iterator.next();                      out.print("\t<option value=\"" + o.getId());                      if (isloc > -1) {                          if (o.getId() == isloc)                              out.print("\" selected=\"selected\">");                          else                              out.print("\">");                      } else {                          if (o.getName().compareTo("Not Specified") == 0)                              out.print("\" selected=\"selected\">");                          else                              out.print("\">");                      }                      out.println(o.getName() + "</option>");                  }              %>          </select>	  </span></div><div class="row">    <span class="label"><label for="mood"><a href="/#/moodlist/" title="List of Moods">Mood</a></label></span>	  <span class="formw">	  	<select id="mood" name="mood" size="1" dojoType="dijit.form.FilteringSelect" autoComplete="false" invalidMessage="Invalid mood">              <%                  Integer smood = (Integer) session.getAttribute("spell.mood");                  int ismood = -1;                  if (smood != null) {                      ismood = smood.intValue();                  }                  for (Iterator iterator = MoodDao.view().iterator(); iterator.hasNext();) {                      MoodTo o = (MoodTo) iterator.next();                      out.print("\t<option value=\"" + o.getId());                      if (ismood > -1) {                          if (o.getId() == ismood)                              out.print("\" selected=\"selected\">");                          else                              out.print("\">");                      } else {                          if (o.getName().compareTo("Not Specified") == 0)                              out.print("\" selected=\"selected\">");                          else                              out.print("\">");                      }                      out.println(o.getName() + "</option>");                  }              %>          </select>	  </span></div><div class="row">    <span class="label"><label for="tags">Tags</label></span>    <span class="formw"><input type="text" name="tags" id="tags" size="30" value="<%=stags%>"                trim="true"></span></div><div class="row">    <span class="label"><label for="music">Music</label></span>    <span class="formw"><input type="text" name="music" id="music" size="30" value="<%=smusic%>"></span></div><div class="row">    <span class="label"><label for="trackback">Trackback</label></span>    <span class="formw"><input type="text" name="trackback" id="trackback" size="30" value="<%=strackback%>" url="true"    required="false"></span></div><div class="row">			<span class="formw"><input type="checkbox" name="allow_comment" id="allow_comment"                                       value="checked" checked="checked" />			<label for="allow_comment">Allow comments on this entry</label>			</span></div><div class="row">			<span class="formw"><input type="checkbox" name="email_comment" id="email_comment"                                       value="checked" checked="checked" />			<label for="email_comment">Email comments to me</label>			</span></div><div class="row" id="aformatrow">			<span class="formw"><input type="checkbox" name="aformat" id="aformat"                                       value="checked" checked="checked" />			<label for="aformat">Auto-formatting</label>			</span></div><!-- Hack to fix spacing problem.. especially with text boxes --><div class="spacer">&nbsp;</div></fieldset><div class="row"><input type="submit" name="submit" value="submit"/></div></form></div></div><jsp:include page="footer.inc" flush="false"/></body></html>